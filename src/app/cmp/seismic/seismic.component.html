<!-- <div style="position:absolute;top:0px;left:0px;border:1px solid red;z-index:589;height:50px;width:50px;">589</div>
<div style="position:absolute;top:50px;left:50px;border:1px solid blue;z-index:589;height:50px;width:50px;">589</div> -->

<app-progress-mask #mask *ngIf="loadingData" [fontFactor]="1" [maskOpacity]=".15" [maskColor]="'white'"
    [message]="maskPrompt"></app-progress-mask>

<div id="map_wrapper" #wrapper>

    <svg id="map_image" *ngIf="showMap" xmlns:mapsvg="http://mapsvg.com" xmlns:dc="http://purl.org/dc/elements/1.1/"
        xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
        xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" [attr.viewBox]="viewBox"
        [attr.width]="mapWidth" [attr.height]="mapHeight">
        <!-- 009dc4 87ceeb -->

        <ng-container *ngFor="let path of mapContours">
            <path *ngIf="isPath(path)" [attr.id]="path.id" [attr.title]="path.title" [attr.d]="path.d"
                [attr.stroke]="path.strokeColor ? path.strokeColor : '#ffc107'"
                [attr.fill]="path.fillColor ? path.fillColor : '#8C6E0E'"
                [attr.stroke-width]="path.strokeWidth ? path.strokeWidth : .707" />

            <rect *ngIf="isRect(path)" [attr.x]="path.x" [attr.y]="path.y" [attr.width]="path.width"
                [attr.height]="path.height" [attr.fill]="path.fillColor ? path.fillColor : 'none'"
                [attr.stroke]="path.strokeColor ? path.strokeColor : 'black'"
                [attr.stroke-width]="path.strokeWidth ? path.strokeWidth : 1" stroke-linecap="round"
                stroke-linejoin="round" stroke-miterlimit="10"></rect>

            <line fill="none" *ngIf="isLine(path)" [attr.stroke]="path.strokeColor ? path.strokeColor : 'black'"
                [attr.stroke-width]="path.strokeWidth ? path.strokeWidth : 1" [attr.x1]="path.x1" [attr.y1]="path.y1"
                [attr.x2]="path.x2" [attr.y2]="path.y2" stroke-linecap="round" stroke-linejoin="round"
                stroke-miterlimit="10" />

            <polyline fill="none" *ngIf="isPoly(path)" [attr.stroke]="path.strokeColor ? path.strokeColor : 'black'"
                [attr.stroke-width]="path.strokeWidth ? path.strokeWidth : 1" [attr.points]="path.points"
                stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" />
        </ng-container>

        <ng-container *ngIf="gridReady">
            <g *ngFor="let path of longLines">
                <line fill="none" [attr.stroke]="refGridLongPx==path.px ? 'red' : gridColor"
                    [attr.stroke-width]="gridWidth" [attr.x1]="path.px" [attr.y1]="0" [attr.x2]="path.px"
                    [attr.y2]="nativeHeight" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" />
                <text [attr.x]="path.px + markerSize/2" [attr.font-size]="gridLabelSize" [attr.y]="viewTop+markerSize"
                    [attr.fill]="gridLabelColor" [attr.stroke-width]=".1"
                    [attr.stroke]="gridLabelColor">{{path.text}}</text>
            </g>

            <g *ngFor="let path of latLines">
                <line fill="none" [attr.stroke]="refGridLatPx==path.px ? 'red' : gridColor"
                    [attr.stroke-width]="gridWidth" [attr.x1]="0" [attr.y1]="path.px" [attr.x2]="nativeWidth"
                    [attr.y2]="path.px" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" />

                <text [attr.x]="viewLeft+markerSize/3" [attr.font-size]="gridLabelSize"
                    [attr.y]="path.px - markerSize/2" [attr.fill]="gridLabelColor" [attr.stroke-width]=".1"
                    [attr.stroke]="gridLabelColor">{{path.text}}</text>

            </g>

        </ng-container>


        <!-- <rect fill="#dc3545" fill-opacity="0.5" [attr.x]="zoomLimits.left" [attr.y]="zoomLimits.top"
            [attr.width]="zoomLimits.width" [attr.height]="zoomLimits.height" stroke="none"
            stroke-dasharray="10,2.5,2.5,2.5,5,5" />

        <rect fill="#28a745" fill-opacity="0.3" [attr.x]="0" [attr.y]="0" [attr.width]="nativeWidth"
            [attr.height]="nativeHeight" stroke="none" stroke-dasharray="10,2.5,2.5,2.5,5,5" /> -->

        <defs>

            <svg id="dotg" [attr.title]="'hello dot!'" class="dotg" viewBox="0 0 100 100" [attr.x]="-markerSize"
                [attr.y]="-markerSize" [attr.width]="markerSize" [attr.height]="markerSize">
                <ellipse cx="50" cy="50" rx="45" ry="45" />
                <path d="M25.5 18.4 L 37 30 L 40.5 26.4 L 47.6 47.6 L 26.4 40.6 L 30 37 L 18.4 25.5z" />
                <path d="M81.6 25.5 L 70 37 L 73.6 40.6 L 52.4 47.6 L 59.4 26.4 L 63 30 L 74.5 18.4z" />
                <path d="M18.4 74.5 L 30 63 L 26.4 59.4 L 47.6 52.4 L 40.5 73.6 L 37 70 L 25.5 81.6z" />
                <path d="M74.5 81.6 L 63 70 L 59.4 73.6 L 52.4 52.4 L 73.6 59.4 L 70 63 L 81.6 74.5z" />
            </svg>

            <svg id="dotv" class="dotv" viewBox="0 0 100 100" [attr.x]="-markerSize" [attr.y]="-markerSize"
                [attr.width]="markerSize" [attr.height]="markerSize">
                <ellipse cx="50" cy="50" rx="45" ry="45" />
                <path d="M25.5 18.4 L 37 30 L 40.5 26.4 L 47.6 47.6 L 26.4 40.6 L 30 37 L 18.4 25.5z" />
                <path d="M81.6 25.5 L 70 37 L 73.6 40.6 L 52.4 47.6 L 59.4 26.4 L 63 30 L 74.5 18.4z" />
                <path d="M18.4 74.5 L 30 63 L 26.4 59.4 L 47.6 52.4 L 40.5 73.6 L 37 70 L 25.5 81.6z" />
                <path d="M74.5 81.6 L 63 70 L 59.4 73.6 L 52.4 52.4 L 73.6 59.4 L 70 63 L 81.6 74.5z" />
            </svg>

            <svg id="doty" class="doty" viewBox="0 0 100 100" [attr.x]="-markerSize" [attr.y]="-markerSize"
                [attr.width]="markerSize" [attr.height]="markerSize">
                <ellipse cx="50" cy="50" rx="45" ry="45" />
                <path d="M25.5 18.4 L 37 30 L 40.5 26.4 L 47.6 47.6 L 26.4 40.6 L 30 37 L 18.4 25.5z" />
                <path d="M81.6 25.5 L 70 37 L 73.6 40.6 L 52.4 47.6 L 59.4 26.4 L 63 30 L 74.5 18.4z" />
                <path d="M18.4 74.5 L 30 63 L 26.4 59.4 L 47.6 52.4 L 40.5 73.6 L 37 70 L 25.5 81.6z" />
                <path d="M74.5 81.6 L 63 70 L 59.4 73.6 L 52.4 52.4 L 73.6 59.4 L 70 63 L 81.6 74.5z" />
            </svg>

            <svg id="sqrrl" [attr.x]="-markerSize" [attr.y]="-markerSize" [attr.width]="markerSize * 10"
                [attr.height]="markerSize * 10" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" style="stroke:gray;stroke-width:4;fill:#ffff00;" />
                <rect x="-27" y="44" width="55" height="55" style="stroke:gray;fill:red;transform: rotate(-45deg);" />
            </svg>

            <svg id="sqrrw" [attr.x]="-markerSize" [attr.y]="-markerSize" [attr.width]="markerSize * 10"
                [attr.height]="markerSize * 10" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" style="stroke:gray;stroke-width:4;fill:#ffff00;" />
                <rect x="-27" y="44" width="55" height="55"
                    style="stroke:gray;stroke-width:4;fill:white;transform: rotate(-45deg);" />
            </svg>

            <svg id="sqrra" [attr.x]="-markerSize" [attr.y]="-markerSize" [attr.width]="markerSize * 10"
                [attr.height]="markerSize * 10" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" style="stroke:gray;stroke-width:4;fill:#ffff00;" />
                <rect x="-27" y="44" width="55" height="55"
                    style="stroke:gray;stroke-width:4;fill:orange;transform: rotate(-45deg);" />
            </svg>

            <radialGradient id="grad_g" r="90%">
                <stop offset="0%" style="stop-color:#c9fdbc;" />
                <stop offset="100%" style="stop-color:#b1bd74;" />
            </radialGradient>
            <radialGradient id="grad_v" r="90%">
                <stop offset="0%" style="stop-color:#efd6f5;" />
                <stop offset="100%" style="stop-color:#bc36de;" />
            </radialGradient>
            <radialGradient id="grad_y" r="90%">
                <stop offset="0%" style="stop-color:#fbfbee;" />
                <stop offset="100%" style="stop-color:#fff600;" />
            </radialGradient>

        </defs>

        <ng-container *ngFor="let evt of events;let idx=index;">
            <use (click)="eventClick(evt)" [attr.href]="dotHREF(evt)" [attr.x]="evt.XTRA.long"
                [attr.y]="evt.XTRA.lat" />

            <!-- <use (click)="eventClick(evt)" [attr.href]="dotHREF(evt)" [attr.x]="DMSToMarker(evt.SIS_LONGDMS)"
                [attr.y]="DMSToMarker(evt.SIS_LATDMS, true)" /> -->

            <!-- { long: this.DMSToMarker(event.SIS_LONGDMS), lat: this.DMSToMarker(event.SIS_LATDMS, true) } -->

        </ng-container>
        <!-- <use (click)="null" [attr.href]="'#dotg'" [attr.x]="DMSToMarker('122 Deg 20 Mins 16 Secs')"
            [attr.y]="DMSToMarker('10 Deg 1 Mins 20 Secs', true)" /> -->
        <use (click)="null" [attr.href]="'#sqrrl'" [attr.x]="DMSToMarker('119 Deg 0 Mins 0 Secs')"
            [attr.width]="markerSize" [attr.height]="markerSize" [attr.y]="DMSToMarker('12 Deg 0 Mins 0 Secs', true)" />

        <use (click)="null" [attr.href]="'#sqrrw'" [attr.x]="DMSToMarker('119 Deg 0 Mins 0 Secs')"
            [attr.width]="markerSize" [attr.height]="markerSize" [attr.y]="DMSToMarker('11 Deg 0 Mins 0 Secs', true)" />

        <use (click)="null" [attr.href]="'#sqrra'" [attr.x]="DMSToMarker('119 Deg 0 Mins 0 Secs')"
            [attr.width]="markerSize" [attr.height]="markerSize"
            [attr.y]="DMSToMarker('11 Deg 30 Mins 0 Secs', true)" />

    </svg>


    <div id="legend">
        <span>Legend</span>
        <svg>
            <use [attr.href]="'#sqrrl'" [attr.x]="markerSize+3" [attr.y]="markerSize+3" 
            [attr.width]="markerLegendSize" [attr.height]="markerLegendSize" />
        </svg>
        <span>Event within inspection triggering gates (action required - RED)</span>
        <svg>
            <use [attr.href]="'#sqrra'" [attr.x]="markerSize+3" [attr.y]="markerSize+3" 
            [attr.width]="markerLegendSize" [attr.height]="markerLegendSize" />
        </svg>
        <span>Event possibly within inspection triggering gates (action required - AMBER)</span>
        <svg>
            <use [attr.href]="'#sqrrw'" [attr.x]="markerSize+3" [attr.y]="markerSize+3" 
            [attr.width]="markerLegendSize" [attr.height]="markerLegendSize" />
        </svg>
        <span>SPEX Asset: Facilities (OGP, SWP/CGS. SSMA, CALM, Sta. Rita)</span>
        <svg>
            <line x1="3" y1="10" [attr.x2]="3+markerLegendSize" y2="10" style="stroke:green;stroke-width:4;" />
        </svg>
        <span>Seismic fault zones</span>
        <svg>
            <use [attr.href]="'#doty'" [attr.x]="markerSize+3" [attr.y]="markerSize+3" 
            [attr.width]="markerLegendSize" [attr.height]="markerLegendSize" />
        </svg>
        <span>Event Magnitude > 5, within the last 90 days (no response required - GREEN)</span>
        <svg>
            <use [attr.href]="'#dotv'" [attr.x]="markerSize+3" [attr.y]="markerSize+3" 
            [attr.width]="markerLegendSize" [attr.height]="markerLegendSize" />
        </svg>
        <span>Event Magnitude > 5, more than 90 days ago (no response required - GREEN)</span>
        <svg>
            <use [attr.href]="'#dotg'" [attr.x]="markerSize+3" [attr.y]="markerSize+3" 
            [attr.width]="markerLegendSize" [attr.height]="markerLegendSize" />
        </svg>
        <span>Event Magnitude < 5, within the last year (no response required - GREEN)</span>
        <svg>
            <line x1="3" y1="10" [attr.x2]="3+markerLegendSize" y2="10" style="stroke:purple;stroke-width:4;" />
        </svg>
        <span>SPEX Asset: pipelines and umbilicals (GEP, CEP, TPFL's, TSR, UMB's A/B)</span>

        <!-- 

Event within inspection triggering gates (action required - RED)
Event possibly within inspection triggering gates (action required - AMBER)
SPEX Asset: Facilities (OGP, SWP/CGS. SSMA, CALM, Sta. Rita)
Seismic fault zones
Event Magnitude > 5, within the last 90 days (no response required - GREEN)
Event Magnitude > 5, more than 90 days ago (no response required - GREEN)
Event Magnitude < 5, within the last year (no response required - GREEN)
SPEX Asset: pipelines and umbilicals (GEP, CEP, TPFL's, TSR, UMB's A/B)

         -->
    </div>


</div>